<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Rebel Stream - Viewer</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      body { background: #000; color: #fff; height: 100vh; margin: 0; overflow: hidden; font-family: system-ui, sans-serif; }
      .viewer-shell { position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
      
      .video-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; display: flex; align-items: center; justify-content: center; background: #000; }
      video { width: 100%; height: 100%; object-fit: contain; }

      #toolboxContainer {
          position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
          z-index: 9999; display: flex; flex-direction: column; align-items: center; gap: 15px; pointer-events: none; 
      }
      #toolboxContainer > * { pointer-events: auto; }

      .chat-overlay {
          position: absolute; bottom: 80px; left: 20px; width: 320px; height: 320px;
          background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px);
          border: 1px solid rgba(255,255,255,0.15); border-radius: 12px;
          display: flex; flex-direction: column; z-index: 100; transition: 0.3s;
      }
      .chat-overlay.hidden { opacity: 0; pointer-events: none; transform: translateY(20px); }
      
      .chat-header { padding: 10px; font-weight: bold; font-size: 0.8rem; background: rgba(0,0,0,0.3); border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; }
      #chatLog { flex: 1; overflow-y: auto; padding: 10px; font-size: 0.9rem; text-shadow: 1px 1px 2px #000; scrollbar-width: thin; }
      .chat-line { margin-bottom: 5px; word-wrap: break-word; }
      .chat-line strong { color: #4af3a3; }
      
      .chat-input-area { padding: 8px; display: flex; flex-direction: column; gap: 5px; background: rgba(0,0,0,0.3); border-radius: 0 0 12px 12px; border-top: 1px solid rgba(255,255,255,0.1); }
      
      .emoji-bar { 
          display: flex; gap: 10px; font-size: 1.3rem; 
          cursor: pointer; user-select: none; margin-bottom: 2px; padding: 0 4px;
          overflow-x: auto;
      }
      
      .input-row { display: flex; gap: 5px; }
      .chat-input { flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; padding: 8px; border-radius: 6px; outline: none; }
      .btn-send { background: #4af3a3; color: #000; border: none; padding: 0 15px; font-weight: bold; border-radius: 6px; cursor: pointer; }

      .controls-bar {
          position: absolute; bottom: 0; left: 0; right: 0; height: 60px;
          background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
          display: flex; align-items: center; justify-content: flex-end; padding: 0 20px; gap: 10px;
          z-index: 101;
      }
      .btn-ctrl { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; }
      .status-pill { margin-right: auto; background: var(--danger); padding: 4px 10px; border-radius: 20px; font-weight: bold; font-size: 0.8rem; }

      .self-video {
          position: absolute; right: 16px; bottom: 80px; width: 160px; height: 90px;
          object-fit: cover; border: 2px solid rgba(255,255,255,0.6); border-radius: 8px;
          z-index: 102; background: #000;
      }
      .self-video.hidden { display: none; }
    </style>
  </head>
  <body>
    <div class="viewer-shell">
        <div class="video-layer">
            <video id="viewerVideo" autoplay playsinline muted></video>
        </div>

        <video id="viewerSelfVideo" class="self-video hidden" autoplay playsinline muted></video>
        
        <div id="toolboxContainer"></div>
        
        <div id="chatBox" class="chat-overlay">
            <div class="chat-header">
                <span>STREAM CHAT</span>
                <span id="viewerStatusMirror" style="opacity:0.7; font-size:0.7rem"></span>
            </div>
            <div id="chatLog"></div>
            <div class="chat-input-area">
                <div id="emojiStrip" class="emoji-bar">
                    <span class="emoji">üòÄ</span><span class="emoji">üòÇ</span><span class="emoji">üòç</span><span class="emoji">üî•</span><span class="emoji">üíÄ</span><span class="emoji">ü§ò</span><span class="emoji">‚ù§Ô∏è</span>
                </div>
                <div class="input-row">
                    <input id="chatInput" class="chat-input" placeholder="Say something..." />
                    <button id="sendBtn" class="btn-send">Send</button>
                </div>
            </div>
        </div>

        <div class="controls-bar">
            <div id="viewerStatus" class="status-pill">OFFLINE</div>
            <button id="requestCallBtn" class="btn-ctrl">‚úã Request to Join</button>
            <button id="toggleChatBtn" class="btn-ctrl">Toggle Chat</button>
            <button id="unmuteBtn" class="btn-ctrl">üîá Unmute</button>
            <button id="fullscreenBtn" class="btn-ctrl">‚õ∂ Fullscreen</button>
        </div>
    </div>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    <script src="config/ice.js"></script>
    <script src="viewer.js"></script>
  </body>
</html>
