<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Rebel Stream</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      body { background: #000; color: #fff; height: 100vh; display: flex; flex-direction: column; overflow: hidden; margin: 0; }
      .viewer-shell { flex: 1; display: flex; flex-direction: column; width: 100%; height: 100%; margin: 0; padding: 0; }
      
      /* Video Container - Takes full space */
      .video-container { 
          position: relative; width: 100%; height: 100%; background: #000; 
          display: flex; align-items: center; justify-content: center; overflow: hidden;
      }
      video { width: 100%; height: 100%; object-fit: contain; }
      
      /* TOOLBOX / ARCADE OVERLAY (Centered) */
      .toolbox-layer {
          position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
          z-index: 9999; pointer-events: auto; display: flex; flex-direction: column; gap: 10px;
          align-items: center;
      }
      
      /* CHAT OVERLAY (Bottom Left) */
      .chat-overlay {
          position: absolute; bottom: 80px; left: 20px;
          width: 320px; max-height: 50%;
          background: rgba(0, 0, 0, 0.6);
          border-radius: 12px;
          display: flex; flex-direction: column;
          backdrop-filter: blur(4px);
          border: 1px solid rgba(255,255,255,0.1);
          z-index: 100;
          transition: transform 0.3s ease, opacity 0.3s ease;
      }
      .chat-overlay.hidden { opacity: 0; pointer-events: none; transform: translateY(20px); }

      .chat-header { padding: 8px 12px; font-size: 0.8rem; font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; }
      #chatLog { flex: 1; overflow-y: auto; padding: 10px; font-size: 0.9rem; text-shadow: 1px 1px 2px #000; scrollbar-width: thin; }
      .chat-line { margin-bottom: 6px; word-wrap: break-word; }
      .chat-line strong { color: #4af3a3; }
      
      .chat-inputs { padding: 8px; background: rgba(0,0,0,0.4); border-top: 1px solid rgba(255,255,255,0.1); }
      .emoji-bar { margin-bottom: 5px; cursor: pointer; user-select: none; }
      .input-row { display: flex; gap: 5px; }
      .text-input { flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; padding: 6px 10px; border-radius: 4px; outline: none; }
      .btn-send { background: #4af3a3; color: #000; border: none; padding: 6px 12px; border-radius: 4px; font-weight: bold; cursor: pointer; }

      /* Controls Bar */
      .controls-bar { 
        position: absolute; bottom: 0; left: 0; right: 0; padding: 15px; 
        background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
        display: flex; gap: 10px; justify-content: flex-end; align-items: center;
        z-index: 101;
      }
      .control-btn { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: #fff; padding: 6px 12px; border-radius: 6px; font-size: 0.85rem; cursor: pointer; }
      .control-btn:hover { background: #fff; color: #000; }
      .status-pill { margin-right: auto; font-size: 0.8rem; background: rgba(229,9,20,0.8); padding: 4px 10px; border-radius: 20px; font-weight: bold; }

      /* Mobile Adjustments */
      @media (max-width: 600px) {
          .chat-overlay { width: 70%; left: 10px; bottom: 70px; }
      }
    </style>
  </head>
  <body>
    <div class="viewer-shell">
      <div class="video-container" id="videoContainer">
        <video id="viewerVideo" autoplay playsinline muted></video>
        
        <div id="toolboxContainer" class="toolbox-layer"></div>
        
        <div id="chatBox" class="chat-overlay">
            <div class="chat-header">
                <span>Live Chat</span>
                <span id="viewerStatusMirror" style="opacity:0.7"></span>
            </div>
            <div id="chatLog"></div>
            <div class="chat-inputs">
                <div id="emojiStrip" class="emoji-bar">
                    <span class="emoji">üòÄ</span><span class="emoji">üòÇ</span><span class="emoji">üòç</span><span class="emoji">üî•</span><span class="emoji">üíÄ</span><span class="emoji">ü§ò</span>
                </div>
                <div class="input-row">
                    <input id="chatInput" class="text-input" placeholder="Chat..." />
                    <button id="sendBtn" class="btn-send">Send</button>
                </div>
            </div>
        </div>

        <div class="controls-bar">
          <div id="viewerStatus" class="status-pill">Connecting...</div>
          <button id="toggleChatBtn" class="control-btn">Toggle Chat</button>
          <button id="unmuteBtn" class="control-btn">üîá Unmute</button>
          <button id="fullscreenBtn" class="control-btn">‚õ∂ Fullscreen</button>
        </div>
      </div>
    </div>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    <script src="config/ice.js"></script>
    <script src="viewer.js"></script>
  </body>
</html>
