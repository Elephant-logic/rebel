<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Rebel Stream / Host</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/style.css" />
</head>
<body class="app-body">
  <div class="app-shell">
    <header class="topbar">
      <div>
        <span class="logo-pill">Rebel Stream</span>
        <span class="topbar-sub">Host Control Room</span>
      </div>
      <div class="topbar-right">
        <span id="hostStatusDot" class="status-dot offline"></span>
        <span id="hostStatusText" class="status-text">Offline</span>
        <button id="btnOpenSettings" class="btn icon-btn" title="Settings">
          âš™
        </button>
      </div>
    </header>

    <main class="layout">
      <!-- LEFT: Host Controls / Room Config -->
      <section class="column column-left">
        <div class="panel">
          <div class="panel-header">
            <span class="panel-title">ðŸ‘‘ Host Controls</span>
            <span class="panel-sub">Room, stream &amp; overlay</span>
          </div>
          <div class="panel-body scroll-y">
            <!-- Room Name -->
            <div class="field">
              <label>Room Slug</label>
              <input
                id="roomInput"
                class="stream-title-input"
                type="text"
                placeholder="e.g. beefy-show"
              />
              <small class="hint">
                Viewers go to
                <code id="viewUrlHint">loading...</code>
              </small>
            </div>

            <!-- Host Display Name -->
            <div class="field">
              <label>Host Name</label>
              <input
                id="displayNameInput"
                class="stream-title-input"
                type="text"
                placeholder="e.g. DJBeefyUK"
              />
            </div>

            <!-- Stream Title -->
            <div class="field">
              <label>Stream Title</label>
              <input
                id="streamTitleInput"
                class="stream-title-input"
                type="text"
                placeholder="Untitled Rebel Stream"
              />
            </div>

            <!-- Start / Stop Buttons -->
            <div class="field row gap">
              <button id="startBtn" class="btn primary grow">Go Live</button>
              <button id="stopBtn" class="btn danger grow" disabled>Stop</button>
            </div>

            <!-- Local Media Setup -->
            <div class="field-group">
              <div class="field">
                <label>Camera</label>
                <select id="cameraSelect" class="stream-title-input"></select>
              </div>
              <div class="field">
                <label>Microphone</label>
                <select id="micSelect" class="stream-title-input"></select>
              </div>
              <div class="field">
                <label>Audio Mode</label>
                <select id="audioModeSelect" class="stream-title-input">
                  <option value="mic">Mic Only</option>
                  <option value="system">System / Desktop</option>
                  <option value="mixed">Mixed</option>
                </select>
              </div>
            </div>

            <!-- Overlay & HTML Layout Side-loader -->
            <div class="field" style="margin-top:15px; border-top:1px solid var(--border); padding-top:10px;">
              <label style="color:var(--accent);">ðŸ–¼ HTML Layout Side-Loader</label>
              <p style="font-size:0.7rem; color:var(--muted); margin-bottom:5px;">
                Upload an HTML file for your overlay UI (ticker, alerts, etc).
              </p>
              <input type="file" id="htmlOverlayInput" accept=".html,.htm" />
              <small id="overlayStatus" class="hint">[None]</small>
            </div>

            <!-- Overlay Toggle -->
            <div class="field" style="margin-top:10px;">
              <button id="overlayToggleBtn" class="btn small secondary full-width">
                Overlay: OFF
              </button>
            </div>

            <!-- Live Injection (auto-detected zones) -->
            <div class="field" style="margin-top:15px; border-top:1px solid var(--border); padding-top:10px;">
              <label style="color:var(--accent);">âš¡ Live Injection</label>
              <p style="font-size:0.7rem; color:var(--muted); margin-bottom:5px;">
                Update specific IDs in your loaded HTML.
              </p>
              <div style="display:flex; flex-direction:column; gap:8px;">
                <select id="injectTargetSelect" class="stream-title-input">
                  <option value="">Detected zones will appear here...</option>
                </select>
                <input
                  type="text"
                  id="injectTargetId"
                  class="stream-title-input"
                  placeholder="HTML ID (e.g. 'ticker')"
                />
                <textarea
                  id="injectValue"
                  class="stream-title-input"
                  style="height:60px;"
                  placeholder="Text, HTML, or &lt;img&gt;..."
                ></textarea>
                <button id="btnInjectContent" class="btn small primary">
                  Push to Overlay
                </button>
              </div>
            </div>

            <!-- VIP / Guest Controls -->
            <div class="field" style="margin-top:15px; border-top:1px solid var(--border); padding-top:10px;">
              <label style="color:var(--accent);">ðŸŽ¤ On-Stage Guests</label>
              <p style="font-size:0.7rem; color:var(--muted); margin-bottom:5px;">
                Promote a viewer to on-stage guest.
              </p>
              <select id="guestSelect" class="stream-title-input"></select>
              <div class="field row gap" style="margin-top:6px;">
                <button id="btnInviteGuest" class="btn small secondary grow">Invite</button>
                <button id="btnKickGuest" class="btn small danger grow">Remove</button>
              </div>
            </div>

          </div>
        </div>

        <!-- Arcade / Tool Push Panel -->
        <div class="panel" style="margin-top:10px;">
          <div class="panel-header">
            <span class="panel-title">ðŸ•¹ Arcade / Tool Push</span>
            <span class="panel-sub">Side-load mini apps & tools</span>
          </div>
          <div class="panel-body scroll-y">
            <div class="field">
              <label>Send File to Viewers</label>
              <input type="file" id="arcadeFileInput" />
              <small class="hint">
                Big patch: up to <strong>50MB</strong> per file, chunked P2P.
              </small>
            </div>
            <div class="field">
              <label>Current Transfer</label>
              <progress id="arcadeProgress" value="0" max="100"></progress>
              <small id="arcadeStatus" class="hint">Idle</small>
            </div>
          </div>
        </div>
      </section>

      <!-- CENTER: Mixer / Preview -->
      <section class="column column-center">
        <div class="panel panel-tall">
          <div class="panel-header">
            <span class="panel-title">ðŸŽ› Stream Mixer</span>
            <span class="panel-sub">Preview of what viewers see</span>
          </div>
          <div class="panel-body mixer-body">
            <div class="mixer-main">
              <canvas id="mixedCanvas" class="video-canvas"></canvas>
              <video
                id="localVideo"
                class="local-video"
                muted
                playsinline
                autoplay
              ></video>
            </div>
            <div class="mixer-controls">
              <div class="field">
                <label>Layout</label>
                <div class="layout-pill-row">
                  <button class="btn small layout-pill" data-layout="solo">
                    Solo Host
                  </button>
                  <button class="btn small layout-pill" data-layout="side-by-side">
                    Host + Guest
                  </button>
                  <button class="btn small layout-pill" data-layout="picture-in-picture">
                    Picture-in-Picture
                  </button>
                </div>
              </div>

              <div class="field">
                <label>Mix Controls</label>
                <div class="toggle-row">
                  <label class="toggle">
                    <input type="checkbox" id="chkShowOverlay" checked />
                    <span>Overlay</span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="chkShowChat" checked />
                    <span>Chat</span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="chkShowStats" checked />
                    <span>Stats Bar</span>
                  </label>
                </div>
              </div>

              <div class="field">
                <label>Output Info</label>
                <div class="stat-pill-row">
                  <div class="stat-pill">
                    <span id="lblFps">FPS: 0</span>
                  </div>
                  <div class="stat-pill">
                    <span id="lblBitrate">Bitrate: 0kbps</span>
                  </div>
                  <div class="stat-pill">
                    <span id="lblResolution">Res: -</span>
                  </div>
                </div>
              </div>

              <div class="field">
                <label>Record / Snapshot</label>
                <div class="field row gap">
                  <button id="btnSnapshot" class="btn small secondary grow">
                    Snapshot
                  </button>
                  <button id="btnRecord" class="btn small secondary grow">
                    Record
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT: Chat / Users / Logs -->
      <section class="column column-right">
        <!-- Chat Panel -->
        <div class="panel panel-chat">
          <div class="panel-header">
            <span class="panel-title">ðŸ’¬ Chat</span>
            <span class="panel-sub">Public + host tools</span>
          </div>
          <div class="panel-body panel-chat-body">
            <div id="chatLog" class="chat-log"></div>
          </div>
          <div class="chat-input-row">
            <input
              id="chatInput"
              class="chat-input"
              type="text"
              placeholder="Send a message..."
            />
            <button id="chatSendBtn" class="btn small primary">Send</button>
          </div>
        </div>

        <!-- Users Panel -->
        <div class="panel panel-users">
          <div class="panel-header">
            <span class="panel-title">ðŸ‘¥ Viewers</span>
            <span class="panel-sub">
              <span id="viewerCount">0</span> watching
            </span>
          </div>
          <div class="panel-body scroll-y">
            <ul id="userList" class="user-list"></ul>
          </div>
        </div>

        <!-- System Log Panel -->
        <div class="panel panel-log">
          <div class="panel-header">
            <span class="panel-title">ðŸ“Ÿ System Log</span>
          </div>
          <div class="panel-body panel-log-body">
            <div id="systemLog" class="system-log"></div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Hidden overlay container for HTML layouts -->
  <div id="hiddenOverlayContainer" class="hidden-overlay-root"></div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <header class="modal-header">
        <h2>Settings</h2>
        <button id="btnCloseSettings" class="btn icon-btn">âœ•</button>
      </header>
      <main class="modal-body">
        <section class="settings-section">
          <h3>ðŸ”Š Audio Options</h3>
          <div class="field">
            <label>Echo Cancellation</label>
            <label class="toggle">
              <input type="checkbox" id="chkEchoCancel" checked />
              <span>Enabled</span>
            </label>
          </div>
          <div class="field">
            <label>Noise Suppression</label>
            <label class="toggle">
              <input type="checkbox" id="chkNoiseSuppression" checked />
              <span>Enabled</span>
            </label>
          </div>
        </section>

        <section class="settings-section">
          <h3>ðŸ“¡ Connection</h3>
          <div class="field">
            <label>Max Bitrate (kbps)</label>
            <input
              id="maxBitrateInput"
              class="stream-title-input"
              type="number"
              min="200"
              max="8000"
              step="100"
              value="2500"
            />
          </div>
        </section>

        <section class="settings-section">
          <h3>ðŸ§ª Debug</h3>
          <div class="field">
            <label>Debug Logs</label>
            <label class="toggle">
              <input type="checkbox" id="chkDebugLogs" />
              <span>Console Verbose</span>
            </label>
          </div>
        </section>
      </main>
      <footer class="modal-footer">
        <button id="btnSaveSettings" class="btn primary">Save</button>
      </footer>
    </div>
  </div>

  <script src="/ice.js"></script>
  <script src="/side-loader.js"></script>
  <script src="/app.js"></script>
</body>
</html>
